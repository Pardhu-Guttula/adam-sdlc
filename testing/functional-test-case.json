[
  {
    "file_path": "backend/authentication/services/login_service.py",
    "file_content": "# Epic Title: User Login\n\nimport logging\nfrom typing import Optional\nfrom backend.authentication.models.user import User\nfrom backend.authentication.models.login import Login\n\nlogger = logging.getLogger(__name__)\n\nclass LoginService:\n\n    @staticmethod\n    def authenticate(login: Login) -> Optional[User]:\n        # Placeholder for actual authentication logic\n        logger.info(f\"Authenticating user with email: {login.email}\")\n        # Simulated authentication logic\n        if login.email == \"existing@user.com\" and login.password == \"correctpassword\":\n            return User(id=1, email=login.email, password=login.password)\n        return None"
  },
  {
    "file_path": "backend/authentication/services/authentication_service.py",
    "file_content": "# Epic Title: User Authentication and Session Management for Secure Login\n\nfrom typing import Optional\nimport jwt\nfrom backend.authentication.models.user import UserRepository, User\nimport logging\n\nclass AuthenticationService:\n    def __init__(self):\n        self.user_repository = UserRepository()\n        self.secret_key = 'your_secret_key'\n\n    def authenticate(self, email: str, password: str) -> Optional[User]:\n        user = self.user_repository.find_by_email(email)\n        if user and user.verify_password(password):\n            return user\n        return None\n\n    def generate_session_token(self, user: User) -> str:\n        payload = {'user_id': user.id}\n        token = jwt.encode(payload, self.secret_key, algorithm='HS256')\n        return token"
  },
  {
    "file_path": "backend/authentication/controllers/mfa_controller.py",
    "file_content": "# Epic Title: Login and Authentication\n\nfrom flask import Blueprint, request, jsonify\nfrom sqlalchemy.exc import SQLAlchemyError\nfrom backend.database.config import get_db\nfrom backend.authentication.repositories.mfa_repository import MFARepository\nfrom backend.authentication.services.mfa_service import MFAService\n\nmfa_bp = Blueprint('mfa', __name__)\n\n@mfa_bp.route('/mfa/setup', methods=['POST'])\ndef setup_mfa():\n    db = next(get_db())\n    data = request.get_json()\n\n    account_id = data.get('account_id')\n    mfa_method = data.get('mfa_method')\n\n    mfa_repository = MFARepository(db)\n    mfa_service = MFAService(mfa_repository)\n\n    try:\n        result = mfa_service.setup_mfa(db, account_id, mfa_method)\n        return jsonify(result), 201\n    except SQLAlchemyError as e:\n        return jsonify({\"error\": \"Unable to process your request\"}), 500\n\n@mfa_bp.route('/mfa/activate', methods=['POST'])\ndef activate_mfa():\n    db = next(get_db())\n    data = request.get_json()\n\n    account_id = data.get('account_id')\n    mfa_method = data.get('mfa_method')\n\n    mfa_repository = MFARepository(db)\n    mfa_service = MFAService(mfa_repository)\n\n    try:\n        result = mfa_service.activate_mfa(db, account_id, mfa_method)\n        return jsonify(result), 201\n    except SQLAlchemyError as e:\n        return jsonify({\"error\": \"Unable to process your request\"}), 500\n\n@mfa_bp.route('/mfa/validate', methods=['POST'])\ndef validate_mfa_token():\n    db = next(get_db())\n    data = request.get_json()\n\n    account_id = data.get('account_id')\n    token = data.get('token')\n\n    mfa_repository = MFARepository(db)\n    mfa_service = MFAService(mfa_repository)\n\n    try:\n        result = mfa_service.validate_mfa_token(db, account_id, token)\n        status_code = 200 if result['success'] else 401\n        return jsonify(result), status_code\n    except SQLAlchemyError as e:\n        return jsonify({\"error\": \"Unable to process your request\"}), 500\n"
  },
  {
    "file_path": "backend/authentication/services/mfa_service.py",
    "file_content": "# Epic Title: Secure Login System with MFA\n\nfrom sqlalchemy.orm import Session\nfrom backend.authentication.repositories.mfa_repository import MFARepository\nimport random\nimport string\n\nclass MFAService:\n    def __init__(self, mfa_repository: MFARepository):\n        self.mfa_repository = mfa_repository\n\n    def generate_token(self) -> str:\n        return ''.join(random.choices(string.ascii_uppercase + string.digits, k=6))\n\n    def create_mfa_token(self, db: Session, account_id: int) -> dict:\n        token = self.generate_token()\n        mfa_token = self.mfa_repository.create_token(account_id, token)\n        return {\"success\": True, \"token\": mfa_token.token}\n\n    def validate_mfa_token(self, db: Session, account_id: int, token: str) -> dict:\n        is_valid = self.mfa_repository.validate_token(account_id, token)\n        return {\"success\": is_valid}"
  },
  {
    "file_path": "backend/authentication/controllers/password_recovery_controller.py",
    "file_content": "# Epic Title: Login and Authentication\n\nfrom flask import Blueprint, request, jsonify\nfrom pydantic import ValidationError\nfrom backend.authentication.models.password_recovery import PasswordRecovery\nfrom backend.authentication.services.password_recovery_service import PasswordRecoveryService\n\npassword_recovery_bp = Blueprint('password_recovery', __name__)\n\n@password_recovery_bp.route('/password-recovery', methods=['POST'])\ndef recover_password():\n    try:\n        recovery_data = request.json\n        recovery_details = PasswordRecovery(**recovery_data)\n        success = PasswordRecoveryService.send_recovery_email(recovery_details.email)\n        if success:\n            return jsonify({\"message\": \"Password recovery email sent\"}), 200\n        else:\n            return jsonify({\"error\": \"Email not recognized\"}), 400\n    except ValidationError as e:\n        return jsonify({\"errors\": e.errors()}), 400\n"
  },
  {
    "file_path": "backend/authentication/repositories/account_repository.py",
    "file_content": "# Epic Title: Secure Login System with MFA\n\nfrom sqlalchemy.orm import Session\nfrom backend.authentication.models.account import Account\nfrom typing import Optional\n\nclass AccountRepository:\n    def __init__(self, db: Session):\n        self.db = db\n\n    def get_account_by_email(self, email: str) -> Optional[Account]:\n        return self.db.query(Account).filter(Account.email == email).first()\n\n    def create_account(self, name: str, email: str, password: str) -> Account:\n        account = Account(name=name, email=email)\n        account.set_password(password)\n        self.db.add(account)\n        self.db.commit()\n        self.db.refresh(account)\n        return account\n\n    def validate_login(self, email: str, password: str) -> Optional[Account]:\n        account = self.get_account_by_email(email)\n        if account and account.check_password(password):\n            return account\n        return None"
  }
]