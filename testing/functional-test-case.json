[
  {
    "file_path": "backend/access_control/models/user.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nclass User:\n    def __init__(self, user_id: int, name: str, email: str, role_id: int):\n        self.user_id = user_id\n        self.name = name\n        self.email = email\n        self.role_id = role_id"
  },
  {
    "file_path": "backend/authentication/services/authentication_service.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nimport datetime\nimport hashlib\nimport secrets\nfrom backend.authentication.models.user import User\nfrom backend.authentication.models.session import Session\nfrom backend.authentication.repositories.user_repository import UserRepository\n\nclass AuthenticationService:\n    def __init__(self, user_repository: UserRepository):\n        self.user_repository = user_repository\n        self.sessions = []\n\n    def login(self, email: str, password: str) -> Optional[Session]:\n        user = self.user_repository.find_by_email(email)\n        if not user or user.hashed_password != self.hash_password(password):\n            return None\n        token = secrets.token_hex(16)\n        valid_until = datetime.datetime.now() + datetime.timedelta(hours=12)\n        session = Session(secrets.token_hex(8), user.user_id, token, valid_until)\n        self.sessions.append(session)\n        return session\n\n    def hash_password(self, password: str) -> str:\n        return hashlib.sha256(password.encode()).hexdigest()"
  },
  {
    "file_path": "backend/authentication/controllers/account_lock_controller.py",
    "file_content": "# Epic Title: User Authentication and Authorization\n\nfrom flask import Blueprint, request, jsonify\nfrom backend.authentication.services.account_lock_service import AccountLockService\n\naccount_lock_controller = Blueprint('account_lock_controller', __name__)\n\n@account_lock_controller.route('/login', methods=['POST'])\ndef login():\n    data = request.get_json()\n    user_id = data.get('user_id')\n    password = data.get('password')\n\n    if user_id is None or password is None:\n        return jsonify({'error': 'Invalid data'}), 400\n\n    success, message = AccountLockService.process_login(user_id, password)\n    if success:\n        return jsonify({'message': 'Login successful'}), 200\n    else:\n        return jsonify({'error': message}), 400\n"
  },
  {
    "file_path": "backend/database/schemas/users.sql",
    "file_content": "-- Epic Title: Implement user authentication and authorization features\n\nCREATE TABLE users (\n    user_id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    email VARCHAR(255) NOT NULL UNIQUE,\n    role_id INT NOT NULL,\n    FOREIGN KEY(role_id) REFERENCES roles(role_id)\n);"
  },
  {
    "file_path": "backend/access_control/repositories/user_repository.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom typing import List, Optional\nfrom backend.access_control.models.user import User\n\nclass UserRepository:\n    def __init__(self):\n        self.users = [\n            User(1, \"John Doe\", \"john@example.com\", 2)\n        ]\n\n    def find_by_email(self, email: str) -> Optional[User]:\n        for user in self.users:\n            if user.email == email:\n                return user\n        return None\n\n    def update_role(self, user_id: int, role_id: int) -> bool:\n        for user in self.users:\n            if user.user_id == user_id:\n                user.role_id = role_id\n                return True\n        return False"
  },
  {
    "file_path": "app.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom backend.authentication.controllers.login_controller import app\n\nif __name__ == \"__main__\":\n    app.run(debug=True)"
  },
  {
    "file_path": "backend/access_control/controllers/role_controller.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom flask import Flask, request, jsonify\nfrom backend.access_control.services.role_service import RoleService\nfrom backend.access_control.repositories.role_repository import RoleRepository\nfrom backend.access_control.repositories.user_repository import UserRepository\n\napp = Flask(__name__)\nrole_repository = RoleRepository()\nuser_repository = UserRepository()\nrole_service = RoleService(role_repository, user_repository)\n\n@app.route('/assign-role', methods=['POST'])\ndef assign_role():\n    data = request.json\n    user_email = data.get(\"email\")\n    role_name = data.get(\"role\")\n    if role_service.assign_role(user_email, role_name):\n        return jsonify({\"message\": \"Role assigned successfully\"}), 200\n    return jsonify({\"error\": \"Failed to assign role\"}), 400\n\n@app.route('/permissions', methods=['GET'])\ndef get_permissions():\n    email = request.args.get(\"email\")\n    permissions = role_service.get_permissions(email)\n    return jsonify({\"permissions\": permissions}), 200"
  },
  {
    "file_path": "backend/access_control/models/role.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom typing import List\n\nclass Role:\n    def __init__(self, role_id: int, name: str, permissions: List[str]):\n        self.role_id = role_id\n        self.name = name\n        self.permissions = permissions"
  },
  {
    "file_path": "backend/database/schemas/roles.sql",
    "file_content": "-- Epic Title: Implement user authentication and authorization features\n\nCREATE TABLE roles (\n    role_id INT PRIMARY KEY AUTO_INCREMENT,\n    name VARCHAR(255) NOT NULL,\n    permissions JSON NOT NULL\n);"
  },
  {
    "file_path": "backend/access_control/services/role_service.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom backend.access_control.repositories.role_repository import RoleRepository\nfrom backend.access_control.repositories.user_repository import UserRepository\n\nclass RoleService:\n    def __init__(self, role_repository: RoleRepository, user_repository: UserRepository):\n        self.role_repository = role_repository\n        self.user_repository = user_repository\n\n    def assign_role(self, user_email: str, role_name: str) -> bool:\n        user = self.user_repository.find_by_email(user_email)\n        role = self.role_repository.get_role_by_name(role_name)\n        if user and role:\n            self.user_repository.update_role(user.user_id, role.role_id)\n            return True\n        return False\n\n    def get_permissions(self, user_email: str) -> list:\n        user = self.user_repository.find_by_email(user_email)\n        if user:\n            role = self.role_repository.get_role_by_name(user.role_id)\n            return role.permissions if role else []\n        return []"
  },
  {
    "file_path": "backend/authentication/controllers/auth_controller.py",
    "file_content": "# Epic Title: User Authentication and Authorization\nimport logging\nfrom flask import Blueprint, request, jsonify\nfrom backend.authentication.services.auth_service import AuthService\n\n# Controller for Authentication\nauth_controller = Blueprint('auth_controller', __name__)\nauth_service = AuthService()\n\n@auth_controller.route('/login', methods=['POST'])\ndef login():\n    try:\n        data = request.json\n        username = data.get('username')\n        password = data.get('password')\n        if auth_service.authenticate(username, password):\n            return jsonify({\"message\": \"Login successful\"}), 200\n        return jsonify({\"message\": \"Invalid credentials\"}), 401\n    except Exception as e:\n        logging.error(f'Error in login: {e}')\n        return jsonify({\"message\": \"Login failed\"}), 500\n\n@auth_controller.route('/register', methods=['POST'])\ndef register():\n    try:\n        data = request.json\n        name = data.get('name')\n        email = data.get('email')\n        password = data.get('password')\n        if auth_service.register(name, email, password):\n            return jsonify({\"message\": \"Registration successful. Please check your email for confirmation.\"}), 201\n        return jsonify({\"message\": \"Registration failed, email may already be in use.\"}), 400\n    except Exception as e:\n        logging.error(f'Error in registration: {e}')\n        return jsonify({\"message\": \"Registration failed\"}), 500\n\n@auth_controller.route('/logout', methods=['POST'])\ndef logout():\n    try:\n        auth_service.logout()\n        return jsonify({\"message\": \"Logout successful\"}), 200\n    except Exception as e:\n        logging.error(f'Error in logout: {e}')\n        return jsonify({\"message\": \"Logout failed\"}), 500"
  },
  {
    "file_path": "backend/database/schemas/sessions.sql",
    "file_content": "-- Epic Title: Implement user authentication and authorization features\n\nCREATE TABLE sessions (\n    session_id VARCHAR(32) PRIMARY KEY,\n    user_id INT NOT NULL,\n    token VARCHAR(32) NOT NULL UNIQUE,\n    valid_until DATETIME NOT NULL,\n    FOREIGN KEY (user_id) REFERENCES users (user_id)\n);"
  },
  {
    "file_path": "backend/authentication/services/logout_service.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom backend.authentication.models.session import Session\n\nclass LogoutService:\n    def __init__(self, active_sessions: list[Session]):\n        self.active_sessions = active_sessions\n\n    def logout(self, token: str) -> bool:\n        for session in self.active_sessions:\n            if session.token == token:\n                self.active_sessions.remove(session)\n                return True\n        return False"
  },
  {
    "file_path": "backend/authentication/controllers/account_lockout_controller.py",
    "file_content": "# Epic Title: User Authentication and Authorization\n\nfrom flask import Blueprint, request, jsonify\nfrom backend.authentication.services.account_lockout_service import AccountLockoutService\n\naccount_lockout_controller = Blueprint('account_lockout_controller', __name__)\n\n@account_lockout_controller.route('/login', methods=['POST'])\ndef login():\n    data = request.get_json()\n    user_id = data.get('user_id')\n    password = data.get('password')\n\n    if user_id is None or password is None:\n        return jsonify({'error': 'Invalid data'}), 400\n\n    # Placeholder for actual authentication logic\n    success = True  # Replace with actual authentication check\n    locked, message = AccountLockoutService.record_attempt_and_check_lockout(user_id, success)\n\n    if locked:\n        return jsonify({'error': message}), 423  # 423 Locked\n    elif not success:\n        return jsonify({'error': message}), 401  # 401 Unauthorized\n    else:\n        return jsonify({'message': message}), 200\n"
  },
  {
    "file_path": "backend/access_control/repositories/role_repository.py",
    "file_content": "# Epic Title: Implement user authentication and authorization features\n\nfrom typing import List, Optional\nfrom backend.access_control.models.role import Role\n\nclass RoleRepository:\n    def __init__(self):\n        self.roles = [\n            Role(1, \"admin\", [\"manage_users\", \"view_reports\", \"edit_content\"]),\n            Role(2, \"user\", [\"view_content\", \"comment\"]),\n            Role(3, \"guest\", [\"view_content\"])\n        ]\n\n    def get_role_by_name(self, name: str) -> Optional[Role]:\n        for role in self.roles:\n            if role.name == name:\n                return role\n        return None"
  }
]